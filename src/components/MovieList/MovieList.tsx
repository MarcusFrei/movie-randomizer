import React from 'react';
import MovieCard from '../MovieCard/MovieCard';
import { useMovieManager } from '../MovieManager/MovieManager';
import MovieFormModal from '../MovieFormModal/MovieFormModal';

interface MovieListProps {
  mode: 'watched' | 'list';
  onImageClick?: (id: number) => void;
}

const MovieList: React.FC<MovieListProps> = ({ mode, onImageClick }) => {
  const {
    movies,
    editingMovie,
    isModalOpen,
    addMovie,
    toggleWatched,
    editOrUpdateMovie,
    deleteMovie,
    setIsModalOpen,
  } = useMovieManager();

  const isWatchedMode = mode === 'watched';

  const filteredMovies = movies.filter((movie) =>
    isWatchedMode ? movie.watched : !movie.watched
  );

  const handleImageClick = (id: number) => {
    if (onImageClick) onImageClick(id);
  };

  const buttonActions = (movieId: number) => {
    const actions = [
      {
        text: isWatchedMode ? '–í–µ—Ä–Ω—É—Ç—å –≤ —Å–ø–∏—Å–æ–∫' : 'üëÅÔ∏è',
        onClick: () => toggleWatched(movieId),
      },
    ];

    if (!isWatchedMode) {
      actions.push(
        { text: '‚úèÔ∏è', onClick: () => editOrUpdateMovie(movieId) },
        { text: 'üóëÔ∏è', onClick: () => deleteMovie(movieId) }
      );
    }

    return actions;
  };

  return (
    <div>
      <h1>{isWatchedMode ? '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã' : '–°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤'}</h1>
      <div className="button_block">
        <button onClick={() => setIsModalOpen(true)} className="add_button">
          ‚ûï
        </button>
      </div>
      {filteredMovies.length === 0 ? (
        <p>
          {isWatchedMode
            ? '–°–ø–∏—Å–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ –ø—É—Å—Ç...'
            : '–§–∏–ª—å–º–æ–≤ –Ω–µ—Ç...'}
        </p>
      ) : (
        <ul>
          {filteredMovies.map((movie) => (
            <MovieCard
              key={movie.id}
              movie={movie}
              actions={buttonActions(movie.id)}
              onImageClick={() => handleImageClick(movie.id)}
            />
          ))}
        </ul>
      )}
      <MovieFormModal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
        initialMovie={editingMovie}
        onSubmit={(title, imageUrl, type) =>
          editingMovie
            ? editOrUpdateMovie(editingMovie.id, { title, imageUrl, type })
            : addMovie(title, imageUrl, type)
        }
        buttonText={editingMovie ? '–û–±–Ω–æ–≤–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å'}
      />
    </div>
  );
};

export default MovieList;

/// –°–¥–µ–ª–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ - —Å–¥–µ–ª–∞–Ω–æ!
/// –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞—Ç—å WatchedMovies, –∞ —Ç–æ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ! - —Å–¥–µ–ª–∞–Ω–æ!
/// https://www.typescriptlang.org/docs/handbook/utility-types.html - !!!–ß–ò–¢–ê–¢–¨ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!!!
/// –ò–∑–±–∞–≤–∏—Ç—Å—è –æ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤ –∞–π–¥–∏—à–Ω–∏–∫–æ–≤ - —Å–¥–µ–ª–∞–Ω–æ!
/// –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ —Å–∞–º–æ–º –∫–æ–¥–µ, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª –∏ —Ç–¥
/// –£–±—Ä–∞—Ç—å –ª—è–º–±–¥—ã —Å—Ç—Ä–æ—á–∫–∞ 44 (onClick) - —Å–¥–µ–ª–∞–Ω–æ!
/// –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã watchedMovies –∏ MovieList - —Å–¥–µ–ª–∞–Ω–æ!
/// –ó–∞–∫–∏–Ω—É—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —É—Ä–ª—É —Ä–∞–Ω–¥–æ–º–Ω—ã–π —Ñ–∏–ª—å–º - —Å–¥–µ–ª–∞–Ω–æ!
/// –ö–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–¥–µ–ª–∞—Ç—å –∏–∫–æ–Ω–∞–º–∏, –∞ –Ω–µ –±—É–∫–æ–≤–∫–∞–º–∏, –Ω–µ –≤ —Å—Ç–æ–ª–±–∏–∫, –∞ –≤ —Ä—è–¥ - —Å–¥–µ–ª–∞–Ω–æ, —Ö–æ—Ç—å –∏ –Ω–µ–Ω–º–æ–≥–æ –∏–Ω–∞—á–µ!
/// –ö–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–∏—Ç—å –æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–¥ —Å–ø–∏—Å–æ–∫, –∞ –∏–Ω–ø—É—Ç—ã –ø–µ—Ä–µ–Ω–µ—Ç–∏ –≤ –º–æ–¥–∞–ª–∫—É, —Ç–æ–∂–µ —Å–∞–º–æ–µ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º - —Å–¥–µ–ª–∞–Ω–æ!
/// —Å–¥–µ–ª–∞—Ç—å –ø–∞–ø–æ—á–∫—É pages, –∫—É–¥–∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—á–∫–∏
/// –í—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ JS - –ø–æ—á–∏—Ç–∞—Ç—å
/// MofieForm - –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –±–∞–Ω–∫–µ—Ç–∞
